{
  "title": "SingleReportSchema",
  "type": "object",
  "required": [
    "tables",
    "id",
    "created_at",
    "datasource"
  ],
  "properties": {
    "tables": {
      "patternProperties": {
        ".+": {
          "title": "TableSchema",
          "type": "object",
          "required": [
            "name",
            "description",
            "row_count",
            "col_count",
            "columns",
            "assertion_results"
          ],
          "properties": {
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "row_count": {
              "type": "integer"
            },
            "col_count": {
              "type": "integer"
            },
            "columns": {
              "type": "object",
              "patternProperties": {
                ".+": {
                  "title": "ColumnSchema",
                  "type": "object",
                  "required": [
                    "total",
                    "non_nulls",
                    "distinct",
                    "name",
                    "description",
                    "type",
                    "schema_type"
                  ],
                  "properties": {
                    "total": {
                      "type": "integer"
                    },
                    "non_nulls": {
                      "type": "integer"
                    },
                    "distinct": {
                      "type": "integer"
                    },
                    "distribution": {
                      "oneOf": [
                        { "type": "null" },
                        { "$ref": "#/definitions/distribution" }
                      ]
                    },
                    "name": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "type": {
                      "enum": [
                        "string",
                        "numeric",
                        "datetime",
                        "bool",
                        "other"
                      ]
                    },
                    "schema_type": {
                      "type": "string"
                    },
                    "mismatched": {
                      "type": "integer"
                    },
                    "sum": {
                      "type": "number"
                    },
                    "avg": {
                      "type": "number"
                    },
                    "min": {
                      "oneOf": [
                       { "type": "string" },
                       { "type": "number" }
                      ]
                    },
                    "max": {
                      "oneOf": [
                       { "type": "string" },
                       { "type": "number" }
                      ]
                    }
                  }
                }
              }
            },
            "assertion_results": {
              "oneOf": [
                { "type": "null" },
                {
                  "title": "AssertionResult",
                  "type": "object",
                  "required": ["tests", "columns"],
                  "properties": {
                    "tests": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/assertion"
                      }
                    },
                    "columns": {
                      "type": "object",
                      "patternProperties": {
                        ".+": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/assertion"
                          }
                        }
                      }
                    }
                  }
                }
              ]
            },
            "dbt_test_results": {
              "oneOf": [
                { "type": "null" },
                {
                  "title": "DbtTestResult",
                  "type": "object",
                  "required": ["tests", "columns"],
                  "properties": {
                    "tests": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/assertion"
                      }
                    },
                    "columns": {
                      "type": "object",
                      "patternProperties": {
                        ".+": {
                          "type": "array",
                          "items": {
                            "$ref": "#/definitions/assertion"
                          }
                        }
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "id": {
      "type": "string"
    },
    "created_at": {
      "type": "string"
    },
    "datasource": {
      "title": "DataSource",
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string"
        }
      }
    }
  },
  "definitions": {
    "distribution": {
      "title": "Distribution",
      "type": "object",
      "required": ["type", "labels", "counts"],
      "properties": {
        "type": {
          "type": "string"
        },
        "labels": {
          "type": "array",
          "items": {
            "oneOf": [
             { "type": "string" },
             { "type": "null" }
            ]
          }
        },
        "counts": {
          "type": "array",
          "items": {
            "type": "integer"
          }
        }
      }
    },
    "assertion": {
      "title": "Assertion",
      "type": "object",
      "required": ["name", "status"],
      "properties": {
        "name": {
          "type": "string"
        },
        "status": {
          "enum": [
            "passed", "failed"
          ]
        },
        "parameters": {
          "type": "object"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
